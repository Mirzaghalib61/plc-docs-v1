{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Sunil/PLC%20User%20Guide%20App/plc-docs-poc/lib/document-generator-simple.ts"],"sourcesContent":["import { Document, Paragraph, TextRun, HeadingLevel, AlignmentType, Table, TableRow, TableCell, WidthType, BorderStyle } from 'docx'\r\nimport { Packer } from 'docx'\r\n\r\ninterface InterviewData {\r\n  id: string\r\n  sme_name: string\r\n  sme_title: string\r\n  equipment_name: string\r\n  equipment_location: string\r\n  current_phase: number\r\n  status: string\r\n  conversation_history: ConversationEntry[]\r\n  created_at: string\r\n  updated_at: string\r\n}\r\n\r\ninterface ConversationEntry {\r\n  timestamp: string\r\n  text: string\r\n  phase: number\r\n  speaker: 'AI' | 'SME' | 'SYSTEM'\r\n}\r\n\r\n/**\r\n * Generate a simple, clean DOCX document from interview data\r\n */\r\nexport async function generateSimpleDocument(interview: InterviewData): Promise<Buffer> {\r\n  console.log('Generating simple document for:', interview.equipment_name)\r\n\r\n  // Extract Q&A pairs\r\n  const qaPairs: Array<{ question: string; answer: string; timestamp: string }> = []\r\n  \r\n  let currentQuestion = ''\r\n  \r\n  for (const entry of interview.conversation_history) {\r\n    if (entry.speaker === 'AI') {\r\n      currentQuestion = entry.text\r\n    } else if (entry.speaker === 'SME' && currentQuestion) {\r\n      qaPairs.push({\r\n        question: currentQuestion,\r\n        answer: entry.text,\r\n        timestamp: entry.timestamp\r\n      })\r\n      currentQuestion = ''\r\n    }\r\n  }\r\n\r\n  // Build document sections\r\n  const children: any[] = []\r\n\r\n  // Title Page\r\n  children.push(\r\n    new Paragraph({\r\n      text: `${interview.equipment_name}`,\r\n      heading: HeadingLevel.TITLE,\r\n      alignment: AlignmentType.CENTER,\r\n      spacing: { after: 200 }\r\n    }),\r\n    new Paragraph({\r\n      text: 'Equipment Operations Manual',\r\n      heading: HeadingLevel.HEADING_1,\r\n      alignment: AlignmentType.CENTER,\r\n      spacing: { after: 400 }\r\n    }),\r\n    new Paragraph({\r\n      text: '',\r\n      spacing: { after: 200 }\r\n    })\r\n  )\r\n\r\n  // Document Information Table\r\n  children.push(\r\n    new Table({\r\n      width: { size: 100, type: WidthType.PERCENTAGE },\r\n      rows: [\r\n        new TableRow({\r\n          children: [\r\n            new TableCell({\r\n              children: [new Paragraph({ text: 'Equipment Name:', bold: true })],\r\n              shading: { fill: 'E3F2FD' }\r\n            }),\r\n            new TableCell({\r\n              children: [new Paragraph(interview.equipment_name)]\r\n            })\r\n          ]\r\n        }),\r\n        new TableRow({\r\n          children: [\r\n            new TableCell({\r\n              children: [new Paragraph({ text: 'Location:', bold: true })],\r\n              shading: { fill: 'E3F2FD' }\r\n            }),\r\n            new TableCell({\r\n              children: [new Paragraph(interview.equipment_location)]\r\n            })\r\n          ]\r\n        }),\r\n        new TableRow({\r\n          children: [\r\n            new TableCell({\r\n              children: [new Paragraph({ text: 'Subject Matter Expert:', bold: true })],\r\n              shading: { fill: 'E3F2FD' }\r\n            }),\r\n            new TableCell({\r\n              children: [new Paragraph(`${interview.sme_name}, ${interview.sme_title}`)]\r\n            })\r\n          ]\r\n        }),\r\n        new TableRow({\r\n          children: [\r\n            new TableCell({\r\n              children: [new Paragraph({ text: 'Interview Date:', bold: true })],\r\n              shading: { fill: 'E3F2FD' }\r\n            }),\r\n            new TableCell({\r\n              children: [new Paragraph(new Date(interview.created_at).toLocaleDateString('en-US', { \r\n                year: 'numeric', \r\n                month: 'long', \r\n                day: 'numeric' \r\n              }))]\r\n            })\r\n          ]\r\n        }),\r\n        new TableRow({\r\n          children: [\r\n            new TableCell({\r\n              children: [new Paragraph({ text: 'Status:', bold: true })],\r\n              shading: { fill: 'E3F2FD' }\r\n            }),\r\n            new TableCell({\r\n              children: [new Paragraph(\r\n                interview.status === 'completed' ? 'Complete' : \r\n                interview.status === 'terminated' ? 'Ended Early - Incomplete' : \r\n                'In Progress'\r\n              )],\r\n              shading: { \r\n                fill: interview.status === 'completed' ? 'C8E6C9' : \r\n                      interview.status === 'terminated' ? 'FFCDD2' : \r\n                      'FFF9C4' \r\n              }\r\n            })\r\n          ]\r\n        })\r\n      ]\r\n    }),\r\n    new Paragraph({\r\n      text: '',\r\n      spacing: { after: 400 }\r\n    })\r\n  )\r\n\r\n  // Warning for incomplete interviews\r\n  if (interview.status === 'terminated') {\r\n    children.push(\r\n      new Paragraph({\r\n        children: [\r\n          new TextRun({\r\n            text: 'âš  WARNING: INCOMPLETE INTERVIEW',\r\n            bold: true,\r\n            color: 'D32F2F',\r\n            size: 28\r\n          })\r\n        ],\r\n        spacing: { after: 200 }\r\n      }),\r\n      new Paragraph({\r\n        text: 'This interview was ended before completion. Not all critical equipment information was gathered. Use this document with caution and consider scheduling a follow-up interview.',\r\n        italics: true,\r\n        spacing: { after: 400 }\r\n      })\r\n    )\r\n  }\r\n\r\n  // Interview Questions & Answers Section\r\n  children.push(\r\n    new Paragraph({\r\n      text: 'Interview Questions & Answers',\r\n      heading: HeadingLevel.HEADING_1,\r\n      spacing: { before: 400, after: 300 },\r\n      pageBreakBefore: true\r\n    }),\r\n    new Paragraph({\r\n      text: `This document contains ${qaPairs.length} question-answer pairs covering critical equipment information.`,\r\n      spacing: { after: 400 }\r\n    })\r\n  )\r\n\r\n  // Add each Q&A pair\r\n  qaPairs.forEach((qa, index) => {\r\n    children.push(\r\n      new Paragraph({\r\n        text: `Question ${index + 1}`,\r\n        heading: HeadingLevel.HEADING_2,\r\n        spacing: { before: 300, after: 100 }\r\n      }),\r\n      new Paragraph({\r\n        children: [new TextRun({ text: qa.question, color: '1976D2' })],\r\n        spacing: { after: 200 },\r\n        border: {\r\n          left: { color: '1976D2', space: 8, size: 12, style: BorderStyle.SINGLE }\r\n        }\r\n      }),\r\n      new Paragraph({\r\n        text: 'Answer',\r\n        bold: true,\r\n        spacing: { before: 100, after: 100 }\r\n      }),\r\n      new Paragraph({\r\n        children: [new TextRun({ text: qa.answer, color: '388E3C' })],\r\n        spacing: { after: 300 },\r\n        border: {\r\n          left: { color: '388E3C', space: 8, size: 12, style: BorderStyle.SINGLE }\r\n        }\r\n      })\r\n    )\r\n  })\r\n\r\n  // Summary Statistics\r\n  children.push(\r\n    new Paragraph({\r\n      text: 'Interview Statistics',\r\n      heading: HeadingLevel.HEADING_1,\r\n      spacing: { before: 400, after: 300 },\r\n      pageBreakBefore: true\r\n    }),\r\n    new Table({\r\n      width: { size: 100, type: WidthType.PERCENTAGE },\r\n      rows: [\r\n        new TableRow({\r\n          children: [\r\n            new TableCell({\r\n              children: [new Paragraph({ text: 'Total Questions Asked:', bold: true })],\r\n              shading: { fill: 'E3F2FD' }\r\n            }),\r\n            new TableCell({\r\n              children: [new Paragraph(qaPairs.length.toString())]\r\n            })\r\n          ]\r\n        }),\r\n        new TableRow({\r\n          children: [\r\n            new TableCell({\r\n              children: [new Paragraph({ text: 'Interview Duration:', bold: true })],\r\n              shading: { fill: 'E3F2FD' }\r\n            }),\r\n            new TableCell({\r\n              children: [new Paragraph(calculateDuration(interview.created_at, interview.updated_at))]\r\n            })\r\n          ]\r\n        }),\r\n        new TableRow({\r\n          children: [\r\n            new TableCell({\r\n              children: [new Paragraph({ text: 'Generated On:', bold: true })],\r\n              shading: { fill: 'E3F2FD' }\r\n            }),\r\n            new TableCell({\r\n              children: [new Paragraph(new Date().toLocaleDateString('en-US', { \r\n                year: 'numeric', \r\n                month: 'long', \r\n                day: 'numeric',\r\n                hour: '2-digit',\r\n                minute: '2-digit'\r\n              }))]\r\n            })\r\n          ]\r\n        })\r\n      ]\r\n    })\r\n  )\r\n\r\n  // Footer note\r\n  children.push(\r\n    new Paragraph({\r\n      text: '',\r\n      spacing: { before: 400 }\r\n    }),\r\n    new Paragraph({\r\n      text: '---',\r\n      alignment: AlignmentType.CENTER,\r\n      spacing: { before: 200, after: 200 }\r\n    }),\r\n    new Paragraph({\r\n      text: 'This document was generated by AI Documentation System',\r\n      alignment: AlignmentType.CENTER,\r\n      italics: true,\r\n      size: 20\r\n    })\r\n  )\r\n\r\n  // Create document\r\n  const doc = new Document({\r\n    sections: [{\r\n      properties: {},\r\n      children: children\r\n    }]\r\n  })\r\n\r\n  // Generate buffer\r\n  const buffer = await Packer.toBuffer(doc)\r\n  console.log('Simple document generated successfully, size:', buffer.length)\r\n  \r\n  return buffer\r\n}\r\n\r\nfunction calculateDuration(start: string, end: string): string {\r\n  const startDate = new Date(start)\r\n  const endDate = new Date(end)\r\n  const diffMs = endDate.getTime() - startDate.getTime()\r\n  const diffMins = Math.floor(diffMs / 60000)\r\n  \r\n  if (diffMins < 60) {\r\n    return `${diffMins} minutes`\r\n  }\r\n  \r\n  const hours = Math.floor(diffMins / 60)\r\n  const mins = diffMins % 60\r\n  return `${hours} hour${hours > 1 ? 's' : ''} ${mins} minutes`\r\n}"],"names":[],"mappings":"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"}},
    {"offset": {"line": 443, "column": 0}, "map": {"version":3,"sources":["file:///C:/Sunil/PLC%20User%20Guide%20App/plc-docs-poc/app/api/interview/%5Bid%5D/generate/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\r\nimport { createClient } from '@supabase/supabase-js'\r\nimport { generateSimpleDocument } from '@/lib/document-generator-simple'\r\n\r\nconst supabase = createClient(\r\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n  process.env.SUPABASE_SERVICE_ROLE_KEY!\r\n)\r\n\r\nexport async function GET(\r\n  request: NextRequest,\r\n  context: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    const { id: interviewId } = await context.params\r\n\r\n    console.log('Generate document API called for interview:', interviewId)\r\n\r\n    // Load interview from database\r\n    const { data: interview, error: fetchError } = await supabase\r\n      .from('interviews')\r\n      .select('*')\r\n      .eq('id', interviewId)\r\n      .single()\r\n\r\n    if (fetchError || !interview) {\r\n      console.error('Interview fetch error:', fetchError)\r\n      return NextResponse.json(\r\n        { error: 'Interview not found' },\r\n        { status: 404 }\r\n      )\r\n    }\r\n\r\n    console.log('Generating document for:', interview.equipment_name)\r\n\r\n    // Generate DOCX document using simple generator\r\n    const documentBuffer = await generateSimpleDocument(interview)\r\n\r\n    // Create filename\r\n    const filename = `${interview.equipment_name.replace(/[^a-z0-9]/gi, '_')}_Operations_Manual_${new Date().toISOString().split('T')[0]}.docx`\r\n\r\n    console.log('Document generated successfully, size:', documentBuffer.length)\r\n\r\n    // Return file with proper headers\r\n    return new NextResponse(documentBuffer, {\r\n      status: 200,\r\n      headers: {\r\n        'Content-Type': 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\r\n        'Content-Disposition': `attachment; filename=\"${filename}\"`,\r\n        'Content-Length': documentBuffer.length.toString(),\r\n      },\r\n    })\r\n\r\n  } catch (error: any) {\r\n    console.error('Document generation error:', error)\r\n\r\n    return NextResponse.json(\r\n      {\r\n        error: 'Failed to generate document',\r\n        details: error?.message || 'Unknown error occurred'\r\n      },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n\r\nexport const maxDuration = 60"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEA,MAAM,WAAW,IAAA,gMAAY,gFAE3B,QAAQ,GAAG,CAAC,yBAAyB;AAGhC,eAAe,IACpB,OAAoB,EACpB,OAA4C;IAE5C,IAAI;QACF,MAAM,EAAE,IAAI,WAAW,EAAE,GAAG,MAAM,QAAQ,MAAM;QAEhD,QAAQ,GAAG,CAAC,+CAA+C;QAE3D,+BAA+B;QAC/B,MAAM,EAAE,MAAM,SAAS,EAAE,OAAO,UAAU,EAAE,GAAG,MAAM,SAClD,IAAI,CAAC,cACL,MAAM,CAAC,KACP,EAAE,CAAC,MAAM,aACT,MAAM;QAET,IAAI,cAAc,CAAC,WAAW;YAC5B,QAAQ,KAAK,CAAC,0BAA0B;YACxC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAsB,GAC/B;gBAAE,QAAQ;YAAI;QAElB;QAEA,QAAQ,GAAG,CAAC,4BAA4B,UAAU,cAAc;QAEhE,gDAAgD;QAChD,MAAM,iBAAiB,MAAM,IAAA,kKAAsB,EAAC;QAEpD,kBAAkB;QAClB,MAAM,WAAW,GAAG,UAAU,cAAc,CAAC,OAAO,CAAC,eAAe,KAAK,mBAAmB,EAAE,IAAI,OAAO,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC;QAE3I,QAAQ,GAAG,CAAC,0CAA0C,eAAe,MAAM;QAE3E,kCAAkC;QAClC,OAAO,IAAI,gJAAY,CAAC,gBAAgB;YACtC,QAAQ;YACR,SAAS;gBACP,gBAAgB;gBAChB,uBAAuB,CAAC,sBAAsB,EAAE,SAAS,CAAC,CAAC;gBAC3D,kBAAkB,eAAe,MAAM,CAAC,QAAQ;YAClD;QACF;IAEF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,8BAA8B;QAE5C,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,OAAO;YACP,SAAS,OAAO,WAAW;QAC7B,GACA;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,MAAM,cAAc"}}]
}