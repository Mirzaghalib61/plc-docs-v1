{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Sunil/PLC%20User%20Guide%20App/plc-docs-poc/app/api/interview/%5Bid%5D/generate/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\r\nimport { createClient } from '@supabase/supabase-js'\r\nimport { generateStructuredDocument } from '@/lib/document-generator-structured'\r\n\r\nconst supabase = createClient(\r\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n  process.env.SUPABASE_SERVICE_ROLE_KEY!\r\n)\r\n\r\nexport async function GET(\r\n  request: NextRequest,\r\n  context: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    const { id: interviewId } = await context.params\r\n\r\n    const { data: interview, error: fetchError } = await supabase\r\n      .from('interviews')\r\n      .select('*')\r\n      .eq('id', interviewId)\r\n      .single()\r\n\r\n    if (fetchError || !interview) {\r\n      return NextResponse.json(\r\n        { error: 'Interview not found' },\r\n        { status: 404 }\r\n      )\r\n    }\r\n\r\n    const documentBuffer = await generateStructuredDocument(interview)\r\n\r\n    const filename = `${interview.equipment_name.replace(/[^a-z0-9]/gi, '_')}_Operations_Manual_${new Date().toISOString().split('T')[0]}.docx`\r\n\r\n    return new NextResponse(documentBuffer, {\r\n      status: 200,\r\n      headers: {\r\n        'Content-Type': 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\r\n        'Content-Disposition': `attachment; filename=\"${filename}\"`,\r\n        'Content-Length': documentBuffer.length.toString(),\r\n      },\r\n    })\r\n\r\n  } catch (error: any) {\r\n    return NextResponse.json(\r\n      {\r\n        error: 'Failed to generate document',\r\n        details: process.env.NODE_ENV === 'development' ? error?.message : undefined\r\n      },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n\r\nexport const maxDuration = 60"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEA,MAAM,WAAW,IAAA,gMAAY,gFAE3B,QAAQ,GAAG,CAAC,yBAAyB;AAGhC,eAAe,IACpB,OAAoB,EACpB,OAA4C;IAE5C,IAAI;QACF,MAAM,EAAE,IAAI,WAAW,EAAE,GAAG,MAAM,QAAQ,MAAM;QAEhD,MAAM,EAAE,MAAM,SAAS,EAAE,OAAO,UAAU,EAAE,GAAG,MAAM,SAClD,IAAI,CAAC,cACL,MAAM,CAAC,KACP,EAAE,CAAC,MAAM,aACT,MAAM;QAET,IAAI,cAAc,CAAC,WAAW;YAC5B,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAsB,GAC/B;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,iBAAiB,MAAM,IAAA,0KAA0B,EAAC;QAExD,MAAM,WAAW,GAAG,UAAU,cAAc,CAAC,OAAO,CAAC,eAAe,KAAK,mBAAmB,EAAE,IAAI,OAAO,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC;QAE3I,OAAO,IAAI,gJAAY,CAAC,gBAAgB;YACtC,QAAQ;YACR,SAAS;gBACP,gBAAgB;gBAChB,uBAAuB,CAAC,sBAAsB,EAAE,SAAS,CAAC,CAAC;gBAC3D,kBAAkB,eAAe,MAAM,CAAC,QAAQ;YAClD;QACF;IAEF,EAAE,OAAO,OAAY;QACnB,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,OAAO;YACP,SAAS,uCAAyC,OAAO,UAAU;QACrE,GACA;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,MAAM,cAAc"}}]
}