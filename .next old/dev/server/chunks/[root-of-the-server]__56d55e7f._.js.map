{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 52, "column": 0}, "map": {"version":3,"sources":["file:///C:/Sunil/PLC%20User%20Guide%20App/plc-docs-poc/lib/document-generator-structured.ts"],"sourcesContent":["import { Document, Paragraph, TextRun, HeadingLevel, AlignmentType, Table, TableRow, TableCell, WidthType, BorderStyle } from 'docx'\r\nimport { Packer } from 'docx'\r\n\r\nconst DEBUG = process.env.NODE_ENV === 'development'\r\n\r\nfunction log(message: string, data?: any) {\r\n  if (DEBUG && data !== undefined) {\r\n    console.log(message, data)\r\n  } else if (DEBUG) {\r\n    console.log(message)\r\n  }\r\n}\r\n\r\ninterface InterviewData {\r\n  id: string\r\n  sme_name: string\r\n  sme_title: string\r\n  equipment_name: string\r\n  equipment_location: string\r\n  current_phase: number\r\n  status: string\r\n  conversation_history: ConversationEntry[]\r\n  created_at: string\r\n  updated_at: string\r\n}\r\n\r\ninterface ConversationEntry {\r\n  timestamp: string\r\n  text: string\r\n  phase: number\r\n  speaker: 'AI' | 'SME' | 'SYSTEM'\r\n}\r\n\r\ninterface StructuredContent {\r\n  sections: {\r\n    title: string\r\n    subsections: {\r\n      title: string\r\n      content: string\r\n      bulletPoints?: string[]\r\n    }[]\r\n  }[]\r\n  skipped_sections: string[]\r\n}\r\n\r\n/**\r\n * Use AI to structure the interview content into logical sections\r\n */\r\nasync function structureContent(interview: InterviewData): Promise<StructuredContent> {\r\n  const fullTranscript = interview.conversation_history\r\n    .map(entry => `[${entry.speaker}]: ${entry.text}`)\r\n    .join('\\n\\n')\r\n  \r\n  const Anthropic = require('@anthropic-ai/sdk')\r\n  const anthropic = new Anthropic({\r\n    apiKey: process.env.ANTHROPIC_API_KEY,\r\n  })\r\n  \r\n  const structuringPrompt = `You are creating a professional PLC Operations Manual from an interview transcript. Analyze the conversation and organize it into a well-structured document.\r\n\r\nEquipment: ${interview.equipment_name}\r\nLocation: ${interview.equipment_location}\r\nSME: ${interview.sme_name}, ${interview.sme_title}\r\n\r\nTRANSCRIPT:\r\n${fullTranscript}\r\n\r\nCreate a structured operations manual with these sections (skip any that weren't covered):\r\n\r\n1. **Equipment Overview**\r\n   - System purpose and function\r\n   - Products/processes handled\r\n   - Critical importance and dependencies\r\n\r\n2. **Critical Operating Information**\r\n   - Key things operators must know\r\n   - Equipment quirks and unusual behaviors\r\n   - Optimal operating ranges and \"sweet spots\"\r\n   - Common mistakes to avoid\r\n\r\n3. **Safety Information**\r\n   - Primary hazards\r\n   - Emergency stops and safety interlocks\r\n   - PPE requirements\r\n   - Stop-work conditions\r\n\r\n4. **Operating Procedures**\r\n   - Startup procedure\r\n   - Normal operation\r\n   - Shutdown procedure\r\n   - Adjustments and when to make them\r\n\r\n5. **Troubleshooting**\r\n   - Common problems and solutions\r\n   - Phantom alarms/nuisance faults\r\n   - Warning signs and symptoms\r\n   - When to call maintenance\r\n\r\n6. **Technical Specifications**\r\n   - PLC and control system details\r\n   - I/O configuration\r\n   - Network/communication details\r\n   - Instrumentation\r\n\r\n7. **Maintenance & Calibration**\r\n   - Calibration procedures\r\n   - Preventive maintenance requirements\r\n   - Critical spare parts\r\n\r\nReturn a JSON structure like this:\r\n\r\n{\r\n  \"sections\": [\r\n    {\r\n      \"title\": \"Section Name\",\r\n      \"subsections\": [\r\n        {\r\n          \"title\": \"Subsection Name\",\r\n          \"content\": \"Main paragraph content here...\",\r\n          \"bulletPoints\": [\"Optional bullet point 1\", \"Optional bullet point 2\"]\r\n        }\r\n      ]\r\n    }\r\n  ],\r\n  \"skipped_sections\": [\"List of sections not covered\"]\r\n}\r\n\r\nIMPORTANT RULES:\r\n- Write in professional, clear, technical language\r\n- Combine information from multiple Q&A exchanges into coherent paragraphs\r\n- Use bullet points for lists, steps, or multiple items\r\n- If information wasn't discussed, don't make it up - skip that section\r\n- Keep it practical and operator-focused\r\n- Include specific details, numbers, and examples mentioned\r\n- Group related information logically\r\n\r\nReturn ONLY the JSON, no markdown formatting.`\r\n\r\n  try {\r\n    const response = await anthropic.messages.create({\r\n      model: 'claude-sonnet-4-20250514',\r\n      max_tokens: 8192,\r\n      messages: [{\r\n        role: 'user',\r\n        content: structuringPrompt\r\n      }]\r\n    })\r\n    \r\n    const content = response.content[0].text\r\n    \r\n    let jsonMatch = content.match(/\\{[\\s\\S]*\\}/)\r\n    \r\n    if (!jsonMatch) {\r\n      const cleanContent = content.replace(/```json\\n?/g, '').replace(/```\\n?/g, '')\r\n      jsonMatch = cleanContent.match(/\\{[\\s\\S]*\\}/)\r\n    }\r\n    \r\n    if (!jsonMatch) {\r\n      throw new Error('Failed to extract JSON from AI response')\r\n    }\r\n    \r\n    return JSON.parse(jsonMatch[0])\r\n  } catch (error) {\r\n    log('AI structuring error:', error)\r\n    return {\r\n      sections: [{\r\n        title: \"Interview Content\",\r\n        subsections: [{\r\n          title: \"Raw Interview Data\",\r\n          content: \"The interview was completed but content structuring failed. Please review the raw Q&A data.\",\r\n          bulletPoints: []\r\n        }]\r\n      }],\r\n      skipped_sections: [\"Content organization failed - please review manually\"]\r\n    }\r\n  }\r\n}\r\n\r\n/**\r\n * Generate a professionally structured DOCX document\r\n */\r\nexport async function generateStructuredDocument(interview: InterviewData): Promise<Buffer> {\r\n  log('Generating structured document for:', interview.equipment_name)\r\n\r\n  const structured = await structureContent(interview)\r\n\r\n  const children: any[] = []\r\n\r\n  // ========== COVER PAGE ==========\r\n  children.push(\r\n    new Paragraph({\r\n      text: interview.equipment_name,\r\n      heading: HeadingLevel.TITLE,\r\n      alignment: AlignmentType.CENTER,\r\n      spacing: { after: 200 }\r\n    }),\r\n    new Paragraph({\r\n      text: 'Operations Manual',\r\n      heading: HeadingLevel.HEADING_1,\r\n      alignment: AlignmentType.CENTER,\r\n      spacing: { after: 100 }\r\n    }),\r\n    new Paragraph({\r\n      text: interview.equipment_location,\r\n      alignment: AlignmentType.CENTER,\r\n      italics: true,\r\n      spacing: { after: 400 }\r\n    })\r\n  )\r\n\r\n  // Document Info Table\r\n  children.push(\r\n    new Table({\r\n      width: { size: 100, type: WidthType.PERCENTAGE },\r\n      rows: [\r\n        new TableRow({\r\n          children: [\r\n            new TableCell({\r\n              children: [new Paragraph({ text: 'Document Title:', bold: true })],\r\n              shading: { fill: 'E3F2FD' },\r\n              width: { size: 30, type: WidthType.PERCENTAGE }\r\n            }),\r\n            new TableCell({\r\n              children: [new Paragraph(`${interview.equipment_name} - Operations Manual`)],\r\n              width: { size: 70, type: WidthType.PERCENTAGE }\r\n            })\r\n          ]\r\n        }),\r\n        new TableRow({\r\n          children: [\r\n            new TableCell({\r\n              children: [new Paragraph({ text: 'Equipment Location:', bold: true })],\r\n              shading: { fill: 'E3F2FD' },\r\n              width: { size: 30, type: WidthType.PERCENTAGE }\r\n            }),\r\n            new TableCell({\r\n              children: [new Paragraph(interview.equipment_location)],\r\n              width: { size: 70, type: WidthType.PERCENTAGE }\r\n            })\r\n          ]\r\n        }),\r\n        new TableRow({\r\n          children: [\r\n            new TableCell({\r\n              children: [new Paragraph({ text: 'Prepared By:', bold: true })],\r\n              shading: { fill: 'E3F2FD' },\r\n              width: { size: 30, type: WidthType.PERCENTAGE }\r\n            }),\r\n            new TableCell({\r\n              children: [new Paragraph(`${interview.sme_name}, ${interview.sme_title}`)],\r\n              width: { size: 70, type: WidthType.PERCENTAGE }\r\n            })\r\n          ]\r\n        }),\r\n        new TableRow({\r\n          children: [\r\n            new TableCell({\r\n              children: [new Paragraph({ text: 'Interview Date:', bold: true })],\r\n              shading: { fill: 'E3F2FD' },\r\n              width: { size: 30, type: WidthType.PERCENTAGE }\r\n            }),\r\n            new TableCell({\r\n              children: [new Paragraph(new Date(interview.created_at).toLocaleDateString('en-US', { \r\n                year: 'numeric', \r\n                month: 'long', \r\n                day: 'numeric' \r\n              }))],\r\n              width: { size: 70, type: WidthType.PERCENTAGE }\r\n            })\r\n          ]\r\n        }),\r\n        new TableRow({\r\n          children: [\r\n            new TableCell({\r\n              children: [new Paragraph({ text: 'Document Status:', bold: true })],\r\n              shading: { fill: 'E3F2FD' },\r\n              width: { size: 30, type: WidthType.PERCENTAGE }\r\n            }),\r\n            new TableCell({\r\n              children: [new Paragraph(\r\n                interview.status === 'completed' ? 'Complete' : \r\n                interview.status === 'terminated' ? 'Incomplete - Ended Early' : \r\n                'Draft - In Progress'\r\n              )],\r\n              shading: { \r\n                fill: interview.status === 'completed' ? 'C8E6C9' : \r\n                      interview.status === 'terminated' ? 'FFCDD2' : \r\n                      'FFF9C4' \r\n              },\r\n              width: { size: 70, type: WidthType.PERCENTAGE }\r\n            })\r\n          ]\r\n        }),\r\n        new TableRow({\r\n          children: [\r\n            new TableCell({\r\n              children: [new Paragraph({ text: 'Generated:', bold: true })],\r\n              shading: { fill: 'E3F2FD' },\r\n              width: { size: 30, type: WidthType.PERCENTAGE }\r\n            }),\r\n            new TableCell({\r\n              children: [new Paragraph(new Date().toLocaleDateString('en-US', { \r\n                year: 'numeric', \r\n                month: 'long', \r\n                day: 'numeric' \r\n              }))],\r\n              width: { size: 70, type: WidthType.PERCENTAGE }\r\n            })\r\n          ]\r\n        })\r\n      ]\r\n    }),\r\n    new Paragraph({\r\n      text: '',\r\n      spacing: { after: 400 }\r\n    })\r\n  )\r\n\r\n  // Warning for incomplete\r\n  if (interview.status === 'terminated') {\r\n    children.push(\r\n      new Table({\r\n        width: { size: 100, type: WidthType.PERCENTAGE },\r\n        rows: [\r\n          new TableRow({\r\n            children: [\r\n              new TableCell({\r\n                children: [\r\n                  new Paragraph({\r\n                    children: [\r\n                      new TextRun({\r\n                        text: '⚠ IMPORTANT NOTICE',\r\n                        bold: true,\r\n                        size: 28,\r\n                        color: 'D32F2F'\r\n                      })\r\n                    ],\r\n                    spacing: { after: 100 }\r\n                  }),\r\n                  new Paragraph({\r\n                    text: 'This document is INCOMPLETE. The interview was ended before all critical information was gathered. Use with caution and schedule a follow-up session to complete missing sections.',\r\n                    size: 22\r\n                  })\r\n                ],\r\n                shading: { fill: 'FFEBEE' },\r\n                margins: { top: 200, bottom: 200, left: 200, right: 200 }\r\n              })\r\n            ]\r\n          })\r\n        ]\r\n      }),\r\n      new Paragraph({\r\n        text: '',\r\n        spacing: { after: 400 }\r\n      })\r\n    )\r\n  }\r\n\r\n  // Skipped sections notice\r\n  if (structured.skipped_sections && structured.skipped_sections.length > 0) {\r\n    children.push(\r\n      new Paragraph({\r\n        text: 'Sections Not Covered in This Interview:',\r\n        bold: true,\r\n        spacing: { before: 200, after: 100 }\r\n      })\r\n    )\r\n    \r\n    structured.skipped_sections.forEach(section => {\r\n      children.push(\r\n        new Paragraph({\r\n          text: `• ${section}`,\r\n          bullet: { level: 0 },\r\n          spacing: { after: 50 }\r\n        })\r\n      )\r\n    })\r\n    \r\n    children.push(\r\n      new Paragraph({\r\n        text: '',\r\n        spacing: { after: 400 }\r\n      })\r\n    )\r\n  }\r\n\r\n  // ========== MAIN CONTENT SECTIONS ==========\r\n  structured.sections.forEach((section, sectionIndex) => {\r\n    children.push(\r\n      new Paragraph({\r\n        text: section.title,\r\n        heading: HeadingLevel.HEADING_1,\r\n        spacing: { before: 400, after: 300 },\r\n        pageBreakBefore: sectionIndex > 0\r\n      })\r\n    )\r\n\r\n    section.subsections.forEach(subsection => {\r\n      children.push(\r\n        new Paragraph({\r\n          text: subsection.title,\r\n          heading: HeadingLevel.HEADING_2,\r\n          spacing: { before: 300, after: 200 }\r\n        })\r\n      )\r\n\r\n      if (subsection.content) {\r\n        children.push(\r\n          new Paragraph({\r\n            text: subsection.content,\r\n            spacing: { after: 200 }\r\n          })\r\n        )\r\n      }\r\n\r\n      if (subsection.bulletPoints && subsection.bulletPoints.length > 0) {\r\n        subsection.bulletPoints.forEach(bullet => {\r\n          children.push(\r\n            new Paragraph({\r\n              text: bullet,\r\n              bullet: { level: 0 },\r\n              spacing: { after: 100 }\r\n            })\r\n          )\r\n        })\r\n        \r\n        children.push(\r\n          new Paragraph({\r\n            text: '',\r\n            spacing: { after: 200 }\r\n          })\r\n        )\r\n      }\r\n    })\r\n  })\r\n\r\n  // ========== DOCUMENT INFORMATION (FINAL PAGE) ==========\r\n  children.push(\r\n    new Paragraph({\r\n      text: 'Document Information',\r\n      heading: HeadingLevel.HEADING_1,\r\n      spacing: { before: 400, after: 300 },\r\n      pageBreakBefore: true\r\n    }),\r\n    new Paragraph({\r\n      text: 'About This Document',\r\n      heading: HeadingLevel.HEADING_2,\r\n      spacing: { before: 200, after: 100 }\r\n    }),\r\n    new Paragraph({\r\n      text: 'This operations manual was generated through an AI-facilitated interview process designed to capture critical equipment knowledge from experienced subject matter experts. The content has been organized and structured for easy reference by operators and maintenance personnel.',\r\n      spacing: { after: 300 }\r\n    }),\r\n    new Paragraph({\r\n      text: 'Interview Metadata',\r\n      heading: HeadingLevel.HEADING_2,\r\n      spacing: { before: 200, after: 100 }\r\n    })\r\n  )\r\n\r\n  // Count Q&A pairs\r\n  let qaCount = 0\r\n  for (let i = 0; i < interview.conversation_history.length - 1; i++) {\r\n    if (interview.conversation_history[i].speaker === 'AI' && \r\n        interview.conversation_history[i + 1].speaker === 'SME') {\r\n      qaCount++\r\n    }\r\n  }\r\n\r\n  children.push(\r\n    new Table({\r\n      width: { size: 100, type: WidthType.PERCENTAGE },\r\n      rows: [\r\n        new TableRow({\r\n          children: [\r\n            new TableCell({\r\n              children: [new Paragraph({ text: 'Questions Asked:', bold: true })],\r\n              shading: { fill: 'F5F5F5' },\r\n              width: { size: 40, type: WidthType.PERCENTAGE }\r\n            }),\r\n            new TableCell({\r\n              children: [new Paragraph(qaCount.toString())],\r\n              width: { size: 60, type: WidthType.PERCENTAGE }\r\n            })\r\n          ]\r\n        }),\r\n        new TableRow({\r\n          children: [\r\n            new TableCell({\r\n              children: [new Paragraph({ text: 'Interview Duration:', bold: true })],\r\n              shading: { fill: 'F5F5F5' },\r\n              width: { size: 40, type: WidthType.PERCENTAGE }\r\n            }),\r\n            new TableCell({\r\n              children: [new Paragraph(calculateDuration(interview.created_at, interview.updated_at))],\r\n              width: { size: 60, type: WidthType.PERCENTAGE }\r\n            })\r\n          ]\r\n        }),\r\n        new TableRow({\r\n          children: [\r\n            new TableCell({\r\n              children: [new Paragraph({ text: 'Sections Covered:', bold: true })],\r\n              shading: { fill: 'F5F5F5' },\r\n              width: { size: 40, type: WidthType.PERCENTAGE }\r\n            }),\r\n            new TableCell({\r\n              children: [new Paragraph(structured.sections.length.toString())],\r\n              width: { size: 60, type: WidthType.PERCENTAGE }\r\n            })\r\n          ]\r\n        })\r\n      ]\r\n    })\r\n  )\r\n\r\n  // Footer\r\n  children.push(\r\n    new Paragraph({\r\n      text: '',\r\n      spacing: { before: 400 }\r\n    }),\r\n    new Paragraph({\r\n      text: '---',\r\n      alignment: AlignmentType.CENTER,\r\n      spacing: { before: 200, after: 200 }\r\n    }),\r\n    new Paragraph({\r\n      text: 'Generated by AI Documentation System',\r\n      alignment: AlignmentType.CENTER,\r\n      italics: true,\r\n      size: 20,\r\n      spacing: { after: 50 }\r\n    }),\r\n    new Paragraph({\r\n      text: 'Preserving Critical Equipment Knowledge',\r\n      alignment: AlignmentType.CENTER,\r\n      italics: true,\r\n      size: 18,\r\n      color: '666666'\r\n    })\r\n  )\r\n\r\n  // Create document\r\n  const doc = new Document({\r\n    sections: [{\r\n      properties: {\r\n        page: {\r\n          margin: {\r\n            top: 1440,\r\n            right: 1440,\r\n            bottom: 1440,\r\n            left: 1440\r\n          }\r\n        }\r\n      },\r\n      children: children\r\n    }]\r\n  })\r\n\r\n  const buffer = await Packer.toBuffer(doc)\r\n  log('Structured document generated successfully, size:', buffer.length)\r\n  \r\n  return buffer\r\n}\r\n\r\nfunction calculateDuration(start: string, end: string): string {\r\n  const startDate = new Date(start)\r\n  const endDate = new Date(end)\r\n  const diffMs = endDate.getTime() - startDate.getTime()\r\n  const diffMins = Math.floor(diffMs / 60000)\r\n  \r\n  if (diffMins < 60) {\r\n    return `${diffMins} minutes`\r\n  }\r\n  \r\n  const hours = Math.floor(diffMins / 60)\r\n  const mins = diffMins % 60\r\n  return `${hours} hour${hours > 1 ? 's' : ''} ${mins} minutes`\r\n}"],"names":[],"mappings":";;;;AAAA;;;AAGA,MAAM,QAAQ,oDAAyB;AAEvC,SAAS,IAAI,OAAe,EAAE,IAAU;IACtC,IAAI,SAAS,SAAS,WAAW;QAC/B,QAAQ,GAAG,CAAC,SAAS;IACvB,OAAO,wCAAW;QAChB,QAAQ,GAAG,CAAC;IACd;AACF;AAkCA;;CAEC,GACD,eAAe,iBAAiB,SAAwB;IACtD,MAAM,iBAAiB,UAAU,oBAAoB,CAClD,GAAG,CAAC,CAAA,QAAS,CAAC,CAAC,EAAE,MAAM,OAAO,CAAC,GAAG,EAAE,MAAM,IAAI,EAAE,EAChD,IAAI,CAAC;IAER,MAAM;IACN,MAAM,YAAY,IAAI,UAAU;QAC9B,QAAQ,QAAQ,GAAG,CAAC,iBAAiB;IACvC;IAEA,MAAM,oBAAoB,CAAC;;WAElB,EAAE,UAAU,cAAc,CAAC;UAC5B,EAAE,UAAU,kBAAkB,CAAC;KACpC,EAAE,UAAU,QAAQ,CAAC,EAAE,EAAE,UAAU,SAAS,CAAC;;;AAGlD,EAAE,eAAe;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;6CAuE4B,CAAC;IAE5C,IAAI;QACF,MAAM,WAAW,MAAM,UAAU,QAAQ,CAAC,MAAM,CAAC;YAC/C,OAAO;YACP,YAAY;YACZ,UAAU;gBAAC;oBACT,MAAM;oBACN,SAAS;gBACX;aAAE;QACJ;QAEA,MAAM,UAAU,SAAS,OAAO,CAAC,EAAE,CAAC,IAAI;QAExC,IAAI,YAAY,QAAQ,KAAK,CAAC;QAE9B,IAAI,CAAC,WAAW;YACd,MAAM,eAAe,QAAQ,OAAO,CAAC,eAAe,IAAI,OAAO,CAAC,WAAW;YAC3E,YAAY,aAAa,KAAK,CAAC;QACjC;QAEA,IAAI,CAAC,WAAW;YACd,MAAM,IAAI,MAAM;QAClB;QAEA,OAAO,KAAK,KAAK,CAAC,SAAS,CAAC,EAAE;IAChC,EAAE,OAAO,OAAO;QACd,IAAI,yBAAyB;QAC7B,OAAO;YACL,UAAU;gBAAC;oBACT,OAAO;oBACP,aAAa;wBAAC;4BACZ,OAAO;4BACP,SAAS;4BACT,cAAc,EAAE;wBAClB;qBAAE;gBACJ;aAAE;YACF,kBAAkB;gBAAC;aAAuD;QAC5E;IACF;AACF;AAKO,eAAe,2BAA2B,SAAwB;IACvE,IAAI,uCAAuC,UAAU,cAAc;IAEnE,MAAM,aAAa,MAAM,iBAAiB;IAE1C,MAAM,WAAkB,EAAE;IAE1B,mCAAmC;IACnC,SAAS,IAAI,CACX,IAAI,qJAAS,CAAC;QACZ,MAAM,UAAU,cAAc;QAC9B,SAAS,wJAAY,CAAC,KAAK;QAC3B,WAAW,yJAAa,CAAC,MAAM;QAC/B,SAAS;YAAE,OAAO;QAAI;IACxB,IACA,IAAI,qJAAS,CAAC;QACZ,MAAM;QACN,SAAS,wJAAY,CAAC,SAAS;QAC/B,WAAW,yJAAa,CAAC,MAAM;QAC/B,SAAS;YAAE,OAAO;QAAI;IACxB,IACA,IAAI,qJAAS,CAAC;QACZ,MAAM,UAAU,kBAAkB;QAClC,WAAW,yJAAa,CAAC,MAAM;QAC/B,SAAS;QACT,SAAS;YAAE,OAAO;QAAI;IACxB;IAGF,sBAAsB;IACtB,SAAS,IAAI,CACX,IAAI,iJAAK,CAAC;QACR,OAAO;YAAE,MAAM;YAAK,MAAM,qJAAS,CAAC,UAAU;QAAC;QAC/C,MAAM;YACJ,IAAI,oJAAQ,CAAC;gBACX,UAAU;oBACR,IAAI,qJAAS,CAAC;wBACZ,UAAU;4BAAC,IAAI,qJAAS,CAAC;gCAAE,MAAM;gCAAmB,MAAM;4BAAK;yBAAG;wBAClE,SAAS;4BAAE,MAAM;wBAAS;wBAC1B,OAAO;4BAAE,MAAM;4BAAI,MAAM,qJAAS,CAAC,UAAU;wBAAC;oBAChD;oBACA,IAAI,qJAAS,CAAC;wBACZ,UAAU;4BAAC,IAAI,qJAAS,CAAC,GAAG,UAAU,cAAc,CAAC,oBAAoB,CAAC;yBAAE;wBAC5E,OAAO;4BAAE,MAAM;4BAAI,MAAM,qJAAS,CAAC,UAAU;wBAAC;oBAChD;iBACD;YACH;YACA,IAAI,oJAAQ,CAAC;gBACX,UAAU;oBACR,IAAI,qJAAS,CAAC;wBACZ,UAAU;4BAAC,IAAI,qJAAS,CAAC;gCAAE,MAAM;gCAAuB,MAAM;4BAAK;yBAAG;wBACtE,SAAS;4BAAE,MAAM;wBAAS;wBAC1B,OAAO;4BAAE,MAAM;4BAAI,MAAM,qJAAS,CAAC,UAAU;wBAAC;oBAChD;oBACA,IAAI,qJAAS,CAAC;wBACZ,UAAU;4BAAC,IAAI,qJAAS,CAAC,UAAU,kBAAkB;yBAAE;wBACvD,OAAO;4BAAE,MAAM;4BAAI,MAAM,qJAAS,CAAC,UAAU;wBAAC;oBAChD;iBACD;YACH;YACA,IAAI,oJAAQ,CAAC;gBACX,UAAU;oBACR,IAAI,qJAAS,CAAC;wBACZ,UAAU;4BAAC,IAAI,qJAAS,CAAC;gCAAE,MAAM;gCAAgB,MAAM;4BAAK;yBAAG;wBAC/D,SAAS;4BAAE,MAAM;wBAAS;wBAC1B,OAAO;4BAAE,MAAM;4BAAI,MAAM,qJAAS,CAAC,UAAU;wBAAC;oBAChD;oBACA,IAAI,qJAAS,CAAC;wBACZ,UAAU;4BAAC,IAAI,qJAAS,CAAC,GAAG,UAAU,QAAQ,CAAC,EAAE,EAAE,UAAU,SAAS,EAAE;yBAAE;wBAC1E,OAAO;4BAAE,MAAM;4BAAI,MAAM,qJAAS,CAAC,UAAU;wBAAC;oBAChD;iBACD;YACH;YACA,IAAI,oJAAQ,CAAC;gBACX,UAAU;oBACR,IAAI,qJAAS,CAAC;wBACZ,UAAU;4BAAC,IAAI,qJAAS,CAAC;gCAAE,MAAM;gCAAmB,MAAM;4BAAK;yBAAG;wBAClE,SAAS;4BAAE,MAAM;wBAAS;wBAC1B,OAAO;4BAAE,MAAM;4BAAI,MAAM,qJAAS,CAAC,UAAU;wBAAC;oBAChD;oBACA,IAAI,qJAAS,CAAC;wBACZ,UAAU;4BAAC,IAAI,qJAAS,CAAC,IAAI,KAAK,UAAU,UAAU,EAAE,kBAAkB,CAAC,SAAS;gCAClF,MAAM;gCACN,OAAO;gCACP,KAAK;4BACP;yBAAI;wBACJ,OAAO;4BAAE,MAAM;4BAAI,MAAM,qJAAS,CAAC,UAAU;wBAAC;oBAChD;iBACD;YACH;YACA,IAAI,oJAAQ,CAAC;gBACX,UAAU;oBACR,IAAI,qJAAS,CAAC;wBACZ,UAAU;4BAAC,IAAI,qJAAS,CAAC;gCAAE,MAAM;gCAAoB,MAAM;4BAAK;yBAAG;wBACnE,SAAS;4BAAE,MAAM;wBAAS;wBAC1B,OAAO;4BAAE,MAAM;4BAAI,MAAM,qJAAS,CAAC,UAAU;wBAAC;oBAChD;oBACA,IAAI,qJAAS,CAAC;wBACZ,UAAU;4BAAC,IAAI,qJAAS,CACtB,UAAU,MAAM,KAAK,cAAc,aACnC,UAAU,MAAM,KAAK,eAAe,6BACpC;yBACA;wBACF,SAAS;4BACP,MAAM,UAAU,MAAM,KAAK,cAAc,WACnC,UAAU,MAAM,KAAK,eAAe,WACpC;wBACR;wBACA,OAAO;4BAAE,MAAM;4BAAI,MAAM,qJAAS,CAAC,UAAU;wBAAC;oBAChD;iBACD;YACH;YACA,IAAI,oJAAQ,CAAC;gBACX,UAAU;oBACR,IAAI,qJAAS,CAAC;wBACZ,UAAU;4BAAC,IAAI,qJAAS,CAAC;gCAAE,MAAM;gCAAc,MAAM;4BAAK;yBAAG;wBAC7D,SAAS;4BAAE,MAAM;wBAAS;wBAC1B,OAAO;4BAAE,MAAM;4BAAI,MAAM,qJAAS,CAAC,UAAU;wBAAC;oBAChD;oBACA,IAAI,qJAAS,CAAC;wBACZ,UAAU;4BAAC,IAAI,qJAAS,CAAC,IAAI,OAAO,kBAAkB,CAAC,SAAS;gCAC9D,MAAM;gCACN,OAAO;gCACP,KAAK;4BACP;yBAAI;wBACJ,OAAO;4BAAE,MAAM;4BAAI,MAAM,qJAAS,CAAC,UAAU;wBAAC;oBAChD;iBACD;YACH;SACD;IACH,IACA,IAAI,qJAAS,CAAC;QACZ,MAAM;QACN,SAAS;YAAE,OAAO;QAAI;IACxB;IAGF,yBAAyB;IACzB,IAAI,UAAU,MAAM,KAAK,cAAc;QACrC,SAAS,IAAI,CACX,IAAI,iJAAK,CAAC;YACR,OAAO;gBAAE,MAAM;gBAAK,MAAM,qJAAS,CAAC,UAAU;YAAC;YAC/C,MAAM;gBACJ,IAAI,oJAAQ,CAAC;oBACX,UAAU;wBACR,IAAI,qJAAS,CAAC;4BACZ,UAAU;gCACR,IAAI,qJAAS,CAAC;oCACZ,UAAU;wCACR,IAAI,mJAAO,CAAC;4CACV,MAAM;4CACN,MAAM;4CACN,MAAM;4CACN,OAAO;wCACT;qCACD;oCACD,SAAS;wCAAE,OAAO;oCAAI;gCACxB;gCACA,IAAI,qJAAS,CAAC;oCACZ,MAAM;oCACN,MAAM;gCACR;6BACD;4BACD,SAAS;gCAAE,MAAM;4BAAS;4BAC1B,SAAS;gCAAE,KAAK;gCAAK,QAAQ;gCAAK,MAAM;gCAAK,OAAO;4BAAI;wBAC1D;qBACD;gBACH;aACD;QACH,IACA,IAAI,qJAAS,CAAC;YACZ,MAAM;YACN,SAAS;gBAAE,OAAO;YAAI;QACxB;IAEJ;IAEA,0BAA0B;IAC1B,IAAI,WAAW,gBAAgB,IAAI,WAAW,gBAAgB,CAAC,MAAM,GAAG,GAAG;QACzE,SAAS,IAAI,CACX,IAAI,qJAAS,CAAC;YACZ,MAAM;YACN,MAAM;YACN,SAAS;gBAAE,QAAQ;gBAAK,OAAO;YAAI;QACrC;QAGF,WAAW,gBAAgB,CAAC,OAAO,CAAC,CAAA;YAClC,SAAS,IAAI,CACX,IAAI,qJAAS,CAAC;gBACZ,MAAM,CAAC,EAAE,EAAE,SAAS;gBACpB,QAAQ;oBAAE,OAAO;gBAAE;gBACnB,SAAS;oBAAE,OAAO;gBAAG;YACvB;QAEJ;QAEA,SAAS,IAAI,CACX,IAAI,qJAAS,CAAC;YACZ,MAAM;YACN,SAAS;gBAAE,OAAO;YAAI;QACxB;IAEJ;IAEA,8CAA8C;IAC9C,WAAW,QAAQ,CAAC,OAAO,CAAC,CAAC,SAAS;QACpC,SAAS,IAAI,CACX,IAAI,qJAAS,CAAC;YACZ,MAAM,QAAQ,KAAK;YACnB,SAAS,wJAAY,CAAC,SAAS;YAC/B,SAAS;gBAAE,QAAQ;gBAAK,OAAO;YAAI;YACnC,iBAAiB,eAAe;QAClC;QAGF,QAAQ,WAAW,CAAC,OAAO,CAAC,CAAA;YAC1B,SAAS,IAAI,CACX,IAAI,qJAAS,CAAC;gBACZ,MAAM,WAAW,KAAK;gBACtB,SAAS,wJAAY,CAAC,SAAS;gBAC/B,SAAS;oBAAE,QAAQ;oBAAK,OAAO;gBAAI;YACrC;YAGF,IAAI,WAAW,OAAO,EAAE;gBACtB,SAAS,IAAI,CACX,IAAI,qJAAS,CAAC;oBACZ,MAAM,WAAW,OAAO;oBACxB,SAAS;wBAAE,OAAO;oBAAI;gBACxB;YAEJ;YAEA,IAAI,WAAW,YAAY,IAAI,WAAW,YAAY,CAAC,MAAM,GAAG,GAAG;gBACjE,WAAW,YAAY,CAAC,OAAO,CAAC,CAAA;oBAC9B,SAAS,IAAI,CACX,IAAI,qJAAS,CAAC;wBACZ,MAAM;wBACN,QAAQ;4BAAE,OAAO;wBAAE;wBACnB,SAAS;4BAAE,OAAO;wBAAI;oBACxB;gBAEJ;gBAEA,SAAS,IAAI,CACX,IAAI,qJAAS,CAAC;oBACZ,MAAM;oBACN,SAAS;wBAAE,OAAO;oBAAI;gBACxB;YAEJ;QACF;IACF;IAEA,0DAA0D;IAC1D,SAAS,IAAI,CACX,IAAI,qJAAS,CAAC;QACZ,MAAM;QACN,SAAS,wJAAY,CAAC,SAAS;QAC/B,SAAS;YAAE,QAAQ;YAAK,OAAO;QAAI;QACnC,iBAAiB;IACnB,IACA,IAAI,qJAAS,CAAC;QACZ,MAAM;QACN,SAAS,wJAAY,CAAC,SAAS;QAC/B,SAAS;YAAE,QAAQ;YAAK,OAAO;QAAI;IACrC,IACA,IAAI,qJAAS,CAAC;QACZ,MAAM;QACN,SAAS;YAAE,OAAO;QAAI;IACxB,IACA,IAAI,qJAAS,CAAC;QACZ,MAAM;QACN,SAAS,wJAAY,CAAC,SAAS;QAC/B,SAAS;YAAE,QAAQ;YAAK,OAAO;QAAI;IACrC;IAGF,kBAAkB;IAClB,IAAI,UAAU;IACd,IAAK,IAAI,IAAI,GAAG,IAAI,UAAU,oBAAoB,CAAC,MAAM,GAAG,GAAG,IAAK;QAClE,IAAI,UAAU,oBAAoB,CAAC,EAAE,CAAC,OAAO,KAAK,QAC9C,UAAU,oBAAoB,CAAC,IAAI,EAAE,CAAC,OAAO,KAAK,OAAO;YAC3D;QACF;IACF;IAEA,SAAS,IAAI,CACX,IAAI,iJAAK,CAAC;QACR,OAAO;YAAE,MAAM;YAAK,MAAM,qJAAS,CAAC,UAAU;QAAC;QAC/C,MAAM;YACJ,IAAI,oJAAQ,CAAC;gBACX,UAAU;oBACR,IAAI,qJAAS,CAAC;wBACZ,UAAU;4BAAC,IAAI,qJAAS,CAAC;gCAAE,MAAM;gCAAoB,MAAM;4BAAK;yBAAG;wBACnE,SAAS;4BAAE,MAAM;wBAAS;wBAC1B,OAAO;4BAAE,MAAM;4BAAI,MAAM,qJAAS,CAAC,UAAU;wBAAC;oBAChD;oBACA,IAAI,qJAAS,CAAC;wBACZ,UAAU;4BAAC,IAAI,qJAAS,CAAC,QAAQ,QAAQ;yBAAI;wBAC7C,OAAO;4BAAE,MAAM;4BAAI,MAAM,qJAAS,CAAC,UAAU;wBAAC;oBAChD;iBACD;YACH;YACA,IAAI,oJAAQ,CAAC;gBACX,UAAU;oBACR,IAAI,qJAAS,CAAC;wBACZ,UAAU;4BAAC,IAAI,qJAAS,CAAC;gCAAE,MAAM;gCAAuB,MAAM;4BAAK;yBAAG;wBACtE,SAAS;4BAAE,MAAM;wBAAS;wBAC1B,OAAO;4BAAE,MAAM;4BAAI,MAAM,qJAAS,CAAC,UAAU;wBAAC;oBAChD;oBACA,IAAI,qJAAS,CAAC;wBACZ,UAAU;4BAAC,IAAI,qJAAS,CAAC,kBAAkB,UAAU,UAAU,EAAE,UAAU,UAAU;yBAAG;wBACxF,OAAO;4BAAE,MAAM;4BAAI,MAAM,qJAAS,CAAC,UAAU;wBAAC;oBAChD;iBACD;YACH;YACA,IAAI,oJAAQ,CAAC;gBACX,UAAU;oBACR,IAAI,qJAAS,CAAC;wBACZ,UAAU;4BAAC,IAAI,qJAAS,CAAC;gCAAE,MAAM;gCAAqB,MAAM;4BAAK;yBAAG;wBACpE,SAAS;4BAAE,MAAM;wBAAS;wBAC1B,OAAO;4BAAE,MAAM;4BAAI,MAAM,qJAAS,CAAC,UAAU;wBAAC;oBAChD;oBACA,IAAI,qJAAS,CAAC;wBACZ,UAAU;4BAAC,IAAI,qJAAS,CAAC,WAAW,QAAQ,CAAC,MAAM,CAAC,QAAQ;yBAAI;wBAChE,OAAO;4BAAE,MAAM;4BAAI,MAAM,qJAAS,CAAC,UAAU;wBAAC;oBAChD;iBACD;YACH;SACD;IACH;IAGF,SAAS;IACT,SAAS,IAAI,CACX,IAAI,qJAAS,CAAC;QACZ,MAAM;QACN,SAAS;YAAE,QAAQ;QAAI;IACzB,IACA,IAAI,qJAAS,CAAC;QACZ,MAAM;QACN,WAAW,yJAAa,CAAC,MAAM;QAC/B,SAAS;YAAE,QAAQ;YAAK,OAAO;QAAI;IACrC,IACA,IAAI,qJAAS,CAAC;QACZ,MAAM;QACN,WAAW,yJAAa,CAAC,MAAM;QAC/B,SAAS;QACT,MAAM;QACN,SAAS;YAAE,OAAO;QAAG;IACvB,IACA,IAAI,qJAAS,CAAC;QACZ,MAAM;QACN,WAAW,yJAAa,CAAC,MAAM;QAC/B,SAAS;QACT,MAAM;QACN,OAAO;IACT;IAGF,kBAAkB;IAClB,MAAM,MAAM,IAAI,oJAAQ,CAAC;QACvB,UAAU;YAAC;gBACT,YAAY;oBACV,MAAM;wBACJ,QAAQ;4BACN,KAAK;4BACL,OAAO;4BACP,QAAQ;4BACR,MAAM;wBACR;oBACF;gBACF;gBACA,UAAU;YACZ;SAAE;IACJ;IAEA,MAAM,SAAS,MAAM,kJAAM,CAAC,QAAQ,CAAC;IACrC,IAAI,qDAAqD,OAAO,MAAM;IAEtE,OAAO;AACT;AAEA,SAAS,kBAAkB,KAAa,EAAE,GAAW;IACnD,MAAM,YAAY,IAAI,KAAK;IAC3B,MAAM,UAAU,IAAI,KAAK;IACzB,MAAM,SAAS,QAAQ,OAAO,KAAK,UAAU,OAAO;IACpD,MAAM,WAAW,KAAK,KAAK,CAAC,SAAS;IAErC,IAAI,WAAW,IAAI;QACjB,OAAO,GAAG,SAAS,QAAQ,CAAC;IAC9B;IAEA,MAAM,QAAQ,KAAK,KAAK,CAAC,WAAW;IACpC,MAAM,OAAO,WAAW;IACxB,OAAO,GAAG,MAAM,KAAK,EAAE,QAAQ,IAAI,MAAM,GAAG,CAAC,EAAE,KAAK,QAAQ,CAAC;AAC/D"}},
    {"offset": {"line": 737, "column": 0}, "map": {"version":3,"sources":["file:///C:/Sunil/PLC%20User%20Guide%20App/plc-docs-poc/app/api/interview/%5Bid%5D/generate/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\r\nimport { createClient } from '@supabase/supabase-js'\r\nimport { generateStructuredDocument } from '@/lib/document-generator-structured'\r\n\r\nconst supabase = createClient(\r\n  process.env.NEXT_PUBLIC_SUPABASE_URL!,\r\n  process.env.SUPABASE_SERVICE_ROLE_KEY!\r\n)\r\n\r\nexport async function GET(\r\n  request: NextRequest,\r\n  context: { params: Promise<{ id: string }> }\r\n) {\r\n  try {\r\n    const { id: interviewId } = await context.params\r\n\r\n    const { data: interview, error: fetchError } = await supabase\r\n      .from('interviews')\r\n      .select('*')\r\n      .eq('id', interviewId)\r\n      .single()\r\n\r\n    if (fetchError || !interview) {\r\n      return NextResponse.json(\r\n        { error: 'Interview not found' },\r\n        { status: 404 }\r\n      )\r\n    }\r\n\r\n    const documentBuffer = await generateStructuredDocument(interview)\r\n\r\n    const filename = `${interview.equipment_name.replace(/[^a-z0-9]/gi, '_')}_Operations_Manual_${new Date().toISOString().split('T')[0]}.docx`\r\n\r\n    return new NextResponse(documentBuffer, {\r\n      status: 200,\r\n      headers: {\r\n        'Content-Type': 'application/vnd.openxmlformats-officedocument.wordprocessingml.document',\r\n        'Content-Disposition': `attachment; filename=\"${filename}\"`,\r\n        'Content-Length': documentBuffer.length.toString(),\r\n      },\r\n    })\r\n\r\n  } catch (error: any) {\r\n    return NextResponse.json(\r\n      {\r\n        error: 'Failed to generate document',\r\n        details: process.env.NODE_ENV === 'development' ? error?.message : undefined\r\n      },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n\r\nexport const maxDuration = 60"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;AAEA,MAAM,WAAW,IAAA,gMAAY,gFAE3B,QAAQ,GAAG,CAAC,yBAAyB;AAGhC,eAAe,IACpB,OAAoB,EACpB,OAA4C;IAE5C,IAAI;QACF,MAAM,EAAE,IAAI,WAAW,EAAE,GAAG,MAAM,QAAQ,MAAM;QAEhD,MAAM,EAAE,MAAM,SAAS,EAAE,OAAO,UAAU,EAAE,GAAG,MAAM,SAClD,IAAI,CAAC,cACL,MAAM,CAAC,KACP,EAAE,CAAC,MAAM,aACT,MAAM;QAET,IAAI,cAAc,CAAC,WAAW;YAC5B,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAsB,GAC/B;gBAAE,QAAQ;YAAI;QAElB;QAEA,MAAM,iBAAiB,MAAM,IAAA,0KAA0B,EAAC;QAExD,MAAM,WAAW,GAAG,UAAU,cAAc,CAAC,OAAO,CAAC,eAAe,KAAK,mBAAmB,EAAE,IAAI,OAAO,WAAW,GAAG,KAAK,CAAC,IAAI,CAAC,EAAE,CAAC,KAAK,CAAC;QAE3I,OAAO,IAAI,gJAAY,CAAC,gBAAgB;YACtC,QAAQ;YACR,SAAS;gBACP,gBAAgB;gBAChB,uBAAuB,CAAC,sBAAsB,EAAE,SAAS,CAAC,CAAC;gBAC3D,kBAAkB,eAAe,MAAM,CAAC,QAAQ;YAClD;QACF;IAEF,EAAE,OAAO,OAAY;QACnB,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,OAAO;YACP,SAAS,uCAAyC,OAAO,UAAU;QACrE,GACA;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,MAAM,cAAc"}}]
}