{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///C:/Sunil/PLC%20User%20Guide%20App/plc-docs-poc/app/api/voice/transcribe/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from 'next/server'\r\nimport OpenAI from 'openai'\r\n\r\nconst openai = new OpenAI({\r\n  apiKey: process.env.OPENAI_API_KEY,\r\n})\r\n\r\nexport async function POST(request: NextRequest) {\r\n  try {\r\n    console.log('Transcribe API called')\r\n    \r\n    const formData = await request.formData()\r\n    const audioFile = formData.get('audio') as File\r\n    const interviewId = formData.get('interviewId') as string\r\n\r\n    console.log('Audio file:', {\r\n      name: audioFile?.name,\r\n      size: audioFile?.size,\r\n      type: audioFile?.type\r\n    })\r\n\r\n    if (!audioFile || audioFile.size === 0) {\r\n      return NextResponse.json(\r\n        { error: 'No valid audio file provided' },\r\n        { status: 400 }\r\n      )\r\n    }\r\n\r\n    if (!interviewId) {\r\n      return NextResponse.json(\r\n        { error: 'No interview ID provided' },\r\n        { status: 400 }\r\n      )\r\n    }\r\n\r\n    if (!process.env.OPENAI_API_KEY) {\r\n      return NextResponse.json(\r\n        { error: 'OpenAI API key not configured' },\r\n        { status: 500 }\r\n      )\r\n    }\r\n\r\n    console.log('Calling OpenAI Whisper API...')\r\n    \r\n    const arrayBuffer = await audioFile.arrayBuffer()\r\n    const buffer = Buffer.from(arrayBuffer)\r\n    const file = new File([buffer], 'audio.wav', { type: 'audio/wav' })\r\n\r\n    const transcription = await openai.audio.transcriptions.create({\r\n      file: file,\r\n      model: 'whisper-1',\r\n      language: 'en',\r\n      response_format: 'text',\r\n    })\r\n\r\n    console.log('Transcription successful:', transcription)\r\n\r\n    return NextResponse.json({\r\n      text: transcription,\r\n      interviewId: interviewId,\r\n      timestamp: new Date().toISOString(),\r\n    })\r\n\r\n  } catch (error: any) {\r\n    console.error('Transcription error:', error?.message)\r\n\r\n    return NextResponse.json(\r\n      { \r\n        error: 'Transcription failed',\r\n        details: error?.message || 'Unknown error',\r\n      },\r\n      { status: 500 }\r\n    )\r\n  }\r\n}\r\n\r\nexport const maxDuration = 30"],"names":[],"mappings":";;;;;;AAAA;AACA;AAAA;;;AAEA,MAAM,SAAS,IAAI,mLAAM,CAAC;IACxB,QAAQ,QAAQ,GAAG,CAAC,cAAc;AACpC;AAEO,eAAe,KAAK,OAAoB;IAC7C,IAAI;QACF,QAAQ,GAAG,CAAC;QAEZ,MAAM,WAAW,MAAM,QAAQ,QAAQ;QACvC,MAAM,YAAY,SAAS,GAAG,CAAC;QAC/B,MAAM,cAAc,SAAS,GAAG,CAAC;QAEjC,QAAQ,GAAG,CAAC,eAAe;YACzB,MAAM,WAAW;YACjB,MAAM,WAAW;YACjB,MAAM,WAAW;QACnB;QAEA,IAAI,CAAC,aAAa,UAAU,IAAI,KAAK,GAAG;YACtC,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA+B,GACxC;gBAAE,QAAQ;YAAI;QAElB;QAEA,IAAI,CAAC,aAAa;YAChB,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAA2B,GACpC;gBAAE,QAAQ;YAAI;QAElB;QAEA,IAAI,CAAC,QAAQ,GAAG,CAAC,cAAc,EAAE;YAC/B,OAAO,gJAAY,CAAC,IAAI,CACtB;gBAAE,OAAO;YAAgC,GACzC;gBAAE,QAAQ;YAAI;QAElB;QAEA,QAAQ,GAAG,CAAC;QAEZ,MAAM,cAAc,MAAM,UAAU,WAAW;QAC/C,MAAM,SAAS,OAAO,IAAI,CAAC;QAC3B,MAAM,OAAO,IAAI,KAAK;YAAC;SAAO,EAAE,aAAa;YAAE,MAAM;QAAY;QAEjE,MAAM,gBAAgB,MAAM,OAAO,KAAK,CAAC,cAAc,CAAC,MAAM,CAAC;YAC7D,MAAM;YACN,OAAO;YACP,UAAU;YACV,iBAAiB;QACnB;QAEA,QAAQ,GAAG,CAAC,6BAA6B;QAEzC,OAAO,gJAAY,CAAC,IAAI,CAAC;YACvB,MAAM;YACN,aAAa;YACb,WAAW,IAAI,OAAO,WAAW;QACnC;IAEF,EAAE,OAAO,OAAY;QACnB,QAAQ,KAAK,CAAC,wBAAwB,OAAO;QAE7C,OAAO,gJAAY,CAAC,IAAI,CACtB;YACE,OAAO;YACP,SAAS,OAAO,WAAW;QAC7B,GACA;YAAE,QAAQ;QAAI;IAElB;AACF;AAEO,MAAM,cAAc"}}]
}